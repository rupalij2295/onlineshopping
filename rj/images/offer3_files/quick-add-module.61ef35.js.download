(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{"6rzJ":function(t,a,i){"use strict";i.r(a);i("ma9I"),i("TeQF"),i("fbCW"),i("oVuX"),i("qePV");var d=i("UF36"),e=i.n(d),n=gbSsrData.language,o=gbCommonInfo,s=o.lang,r=o.currency,c=o.GB_cssRight;o.IS_RW;function l(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$(t+" .c-opt").remove(),$(t).append(ejs.compile(e.a,{client:!0,delimiter:"$"})({quick_add_info:a.quickAddInfo,size_rule:a.sizeRule,goods_id:a.goodsId,GB_cssRight:a.gBCssRight},null,(function(t,a){})))}window.quick_add={data:{goods_data:{},loading:{},limit_tip:null,index:0},controller:{},define_reactive_controller:function(t){var a=this.controller[t]={id:t};Object.defineProperty(a,"show_quick_add_ctn",{set:function(t){var a=this;this._show_quick_add_ctn=t,t?($(".j-btn-add-to-bag-"+a.id).addClass("she-hide"),$(".j-absolute-quick-add-"+a.id).show().find(".j-quick-add-ctn").addClass("animated slideInUp").one("animationend",(function(){$(this).removeClass("animated slideInUp")}))):($(".j-absolute-quick-add-"+a.id).find(".j-quick-add-ctn").addClass("animated slideOutDown").one("animationend",(function(){$(".j-absolute-quick-add-"+a.id).hide(),$(this).removeClass("animated slideOutDown")})),$(".j-btn-add-to-bag-"+a.id).removeClass("she-hide"))}}),Object.defineProperty(a,"show_quick_add_mask",{set:function(a){this._show_quick_add_mask=a,a?($(".j-btn-add-to-bag-"+this.id).addClass("she-hide"),$(".j-add-result-mask-"+t).fadeIn("300")):($(".j-add-result-mask-"+t).fadeOut("300"),$(".j-btn-add-to-bag-"+this.id).removeClass("she-hide"))}}),Object.defineProperty(a,"quick_adding",{set:function(a){this._quick_adding=a,a?$(".j-add-result-mask-"+t).find(".j-la-ball-pulse").show():$(".j-add-result-mask-"+t).find(".j-la-ball-pulse").hide()}}),Object.defineProperty(a,"quick_result",{set:function(a){this._quick_result=a,a&&$(".j-add-result-mask-"+t).find(".j-result-txt").html(a)}}),Object.defineProperty(a,"show_quick_result",{set:function(a){this._show_quick_result=a,a?$(".j-add-result-mask-"+t).find(".j-result-txt").show():$(".j-add-result-mask-"+t).find(".j-result-txt").hide()}}),Object.defineProperty(a,"show_stock_error",{set:function(t){this._show_stock_error=t,t&&$(".j-absolute-quick-add-"+this.id).find(".j-stock-error").show().next(".j-quick-add-opt-ctn").hide()}}),Object.defineProperty(a,"show_quick_add_loading",{set:function(t){this._show_quick_add_loading=t,t?$(".j-btn-add-to-bag-"+this.id).addClass("qa-loading"):$(".j-btn-add-to-bag-"+this.id).removeClass("qa-loading")}})},init:function(t){this.data.goods_data=t,this.bind_event(),this.init_cart_limit_tip_vue()},bind_event:function(){var t=this;$(document).on("".concat("au"!=s?"click":"mouseenter"),".j-btn-add-to-bag",(function(a){var i=$(this);$(".j-add-bag-submit")&&($(".j-add-bag-submit").hasClass("disabled")&&$(".j-add-bag-submit").removeClass("disabled"),$(".j-add-bag-submit").attr("disabled")&&$(".j-add-bag-submit").removeAttr("disabled")),i.hasClass("j-btn-add-to-bag-no-attr")||t.open_quick_add(i,i.data("id"),i.data("index"))})).on("click",".j-quick-add-opt",(function(a){var i=$(this);+$(this).children(".opt").attr("data-stock")<=0?($(".j-add-bag-submit").hasClass("disabled")||$(".j-add-bag-submit").addClass("disabled"),$(".j-add-bag-submit").attr("disabled")||$(".j-add-bag-submit").attr("disabled","true")):($(".j-add-bag-submit").hasClass("disabled")&&$(".j-add-bag-submit").removeClass("disabled"),$(".j-add-bag-submit").attr("disabled")&&$(".j-add-bag-submit").removeAttr("disabled")),t.click_size(i.data("id"),i.data("index"))})).on("click",".j-add-bag-submit",(function(a){var i=$(this);t.submit_quick_add(this,i.data("id"),"hasAttr")})).on("click",".j-add-bag-cancel",(function(a){t.controller[$(this).data("id")].show_quick_add_ctn=!1})),"au"==s&&$(document).on("change",".j-quick-add-opt input",(function(a){var i=$(this).data("id");t.submit_quick_add($(".j-add-bag-submit-"+i)[0],i,"hasAttr")})).on("click",".j-btn-add-to-bag-no-attr",(function(a){var i=$(this).data("id");t.submit_quick_add($(".j-add-bag-submit-"+i)[0],i,"noAttr")}))},open_quick_add:function(t,a,i){var d,e=this,n=e.data.goods_data[a],o=SHEIN_W.getQueryString("page")||1;i=Number(t.attr("data-index")),[n.goods_id,n.goods_sn,n.productRelationID,isNaN(i)?"":i+1,o,1,n.rec_mark,n.extra_mark,"pri_"+n.salePrice.usdAmount].join("`");if(n.front_end_data&&n.front_end_data.quick_add_info||e.data.loading[a])n.front_end_data&&n.front_end_data.quick_add_info&&("au"==s&&$(".j-quick-add-opt-"+a+" .j-quick-add-opt input:checked").removeAttr("checked"),l(".j-quick-add-opt-"+a,{quickAddInfo:n.front_end_data.quick_add_info,sizeRule:n.front_end_data.size_rule||{},goodsId:a,gBCssRight:c}),1==n.front_end_data.quick_add_info.length?t.find(".j-quick-add-opt").click():0==n.front_end_data.quick_add_info.length&&(e.controller[a].show_stock_error=!0),e.controller[a].show_quick_add_ctn=!0);else{e.data.loading[a]=!0,e.define_reactive_controller(a),$.when((d=$.Deferred(),$.ajax({url:"/product/attr",data:{id:a,_t:Date.now()}}).done((function(t){d.resolve(t)})).always((function(){e.data.loading[a]=!1,d.resolve()})),d.promise()),function(){var t=$.Deferred();return $.ajax({url:"/product/getSizeRules",data:{goods_ids:a}}).done((function(a){t.resolve(a)})).fail((function(a){t.resolve()})),t.promise()}()).then((function(d,o){d&&0==d.code?(d.info.attrSize=d.info.attrSize.filter((function(t){return!!(t.price&&t.price.salePrice&&t.price.retailPrice)})),o&&0==o.code&&o.info&&o.info[a]&&Array.isArray(o.info[a].size_rule_list)&&o.info[a].size_rule_list.length>0&&$(".j-quick-add-opt-"+a).parents(".j-quick-add-ctn").addClass("n-quick-add-ctn"),l(".j-quick-add-opt-"+a,{quickAddInfo:d.info.attrSize,sizeRule:o&&o.info[a]||{},goodsId:a,gBCssRight:c}),1==d.info.attrSize.length?(t.find(".j-quick-add-opt").click(),e.saExposePopup(a,i)):0==d.info.attrSize.length?e.controller[a].show_stock_error=!0:e.saExposePopup(a,i),e.controller[a].show_quick_add_ctn=!0,n.front_end_data||(n.front_end_data={}),n.front_end_data.quick_add_info=d.info.attrSize,n.front_end_data.size_rule=o&&o.info[a]||null):d&&200302==d.code&&("au"!=s?e.submit_quick_add($(".j-add-bag-submit-"+a)[0],a,"noAttr"):t.hasClass("j-btn-add-to-bag-no-attr")||t.addClass("j-btn-add-to-bag-no-attr"))}))}},submit_quick_add:function(t,a,i){var d,e=this,o=$(".j-quick-add-opt-"+a),c={};if(!e.controller[a].quick_adding){if(0==o.find("input:checked").length&&"noAttr"!==i)return o.addClass("animated animate-shake").one("animationend",(function(){o.removeClass("animated animate-shake")})),void("undefined"!=typeof gaEventCenter&&gaEventCenter.$emit("addBag",{el:t,quantity:1,value:0,reason:"no select size",res:{code:1},postData:{goods_id:a}}));"noAttr"!==i&&(c=e.data.goods_data[a].front_end_data.quick_add_info[o.find("input:checked").data("index")]),d={goods_id:a,quantity:1,attrs:[{attr_id:c.attr_id||"",attr_value_id:c.attr_value_id||""}]};var l=gbExposeTraceid("getComponent",{componentName:"goodslist"});l&&(d.trace_id=l),e.controller[a].show_quick_add_ctn=!1,e.controller[a].show_quick_add_mask=!0,e.controller[a].quick_adding=!0,$.ajax({url:"/cart/add",type:"POST",data:d}).done((function(i){0==i.code&&i.info?(cart_module.recart(i),e.controller[a].quick_result=n.lang_category_added_successfully,gaEventCenter.$emit("addBag",{el:t,quantity:1,value:1,size:d.attrs[0].attr_value_id,res:i,postData:d}),"undefined"!=typeof doFbq&&doFbq("AddToCart",{content_name:"Shopping Cart",content_ids:a}),"function"==typeof mkq&&mkq("track","AddToCart",{content_name:e.data.goods_data[a].goods_name,content_ids:[a],content_type:"product",value:e.data.goods_data[a].salePrice.amount,currency:r}),"us"===s&&window.pintrk_cart_add&&pintrk_cart_add({data:i,goods_id:d.goods_id,order_quantity:d.quantity,currency:window.gbCommonInfo&&gbCommonInfo.currency||""}),window.branchEvent&&window.branchEvent.addToCart({sku:d.goods_id,quantity:d.quantity})):(200401==i.code||500301==i.code?e.controller[a].quick_result=n.lang_goods_only_one:300402==i.code?e.controller[a].quick_result=n.lang_goods_out:500302==i.code?e.controller[a].quick_result=SHEIN_W.template(i.info.limitCount,n.lang_goods_limit_buy):500303==i.code?e.controller[a].quick_result=n.SHEIN_PC_KEY_3274:300407==i.code?(e.data.limit_tip.cartLimitTips=!0,setTimeout((function(){e.data.limit_tip.cartLimitTips=!1}),2e3)):e.controller[a].quick_result=n.lang_goods_error,gaEventCenter.$emit("addBag",{el:t,quantity:1,value:0,res:i,postData:d}))})).always((function(){e.controller[a].quick_adding=!1,e.controller[a].show_quick_result=!0,setTimeout((function(){e.controller[a].show_quick_result=!1,e.controller[a].show_quick_add_mask=!1}),1e3)}))}},click_size:function(t,a){var i=this.data.goods_data[t],d=this.data.goods_data[t].front_end_data.quick_add_info[a].price;i.salePrice.amount==d.salePrice.amount&&i.retailPrice.amount==d.retailPrice.amount||($(".j-gds-li-price-"+t+", .j-gds-li-price-"+t+" .j-price-discount, .j-gds-li-discount-"+t).removeClass("will-show she-show she-inline-block"),GB_SHEIN_goods_list.update_one_price(t,this.data.goods_data[t].front_end_data.quick_add_info[a].price),$(".j-gds-li-price-"+t+", .j-gds-li-discount-"+t+".will-show").addClass("she-show"),$(".j-gds-li-price-"+t+" .will-show").addClass("she-inline-block"))},init_cart_limit_tip_vue:function(){this.data.limit_tip=new Vue({el:".j-quick-add-cart-limit-tip",data:{cartLimitTips:!1}})},saExposePopup:function(t,a){var i=this.data.goods_data[t],d=[i.goods_id,i.goods_sn,i.productRelationID,a+1,parseInt(SHEIN_W.getQueryString("page"))||1,1,"","","pri_".concat(i.salePrice.usdAmount,"|pri_").concat(i.retailPrice.usdAmount),""].join("`");sa("send",{activity_name:"expose_popup_quick_view",activity_param:{goods_list:d,activity_from:"goods_list",style:"size"}})}},quick_add.init(GB_SHEIN_goods_list.data.goods_data_obj)},UF36:function(t,a){t.exports='<$ if (quick_add_info) { $>\n    <$ if (size_rule && size_rule.size_rule_list && size_rule.size_rule_list.length > 0){ $>\n        <div class="c-opt">\n            <div class="size-row">\n                <$ quick_add_info.forEach(function(item, index,arr) { $>\n                    <div class="size-item">\n                        <$ if (index == 0){ $>\n                            <span class="location-rule">\n                                <template v-if="item.attr_value_en != \'one-size\'">\n                                    (<$=size_rule.country_code $>)\n                                </template>\n                            </span>\n                        <$ } $>\n                        <label class="opt-size j-quick-add-opt" data-id="<$=goods_id$>" data-index="<$=index$>">\n                            <input class="opt"\n                                type="radio"\n                                name="size<$=goods_id$>"\n                                value="<$=index$>"\n                                data-id="<$=goods_id$>"\n                                data-stock="<$=item.stock$>"\n                                data-index="<$=index$>"\n                                >\n                            <span class="opt-real <$ if(item.attr_value && item.attr_value.length>2 || item.attr_std_value) { $>opt-long-txt<$ } $>  <$ if (item.stock <= 0) { $>size-sold-out sold-out<$ }  $>">\n                                <$ if (item.attr_std_value){ $>\n                                    <$ if(GB_cssRight){ $>\n                                        <$=item.attr_value$> / <strong><$=item.attr_std_value$></strong>\n                                    <$ }else{ $>\n                                        <strong><$=item.attr_std_value$></strong> / <$=item.attr_value$>\n                                    <$ } $>\n                                <$ }else{ $>\n                                    <$=item.attr_value$>\n                                <$ } $>\n                            </span>\n                        </label>\n                        <span class="location-size">\n                        <$ size_rule.size_rule_list.forEach(function(locationsize) { $>\n                            <$ if (locationsize.name == item.attr_value_en && item.attr_value_en != \'one-size\'){ $>\n                                <$=locationsize.correspond$>\n                            <$ } $>\n                        <$ }) $>\n                        </span>\n                    </div>\n                <$ }) $>\n            </div>\n        </div>\n    <$ }else{ $>\n        <div class="c-opt">\n            <$ quick_add_info.forEach(function(item, index) { $>\n                <label class="opt-size j-quick-add-opt" data-id="<$=goods_id$>" data-index="<$=index$>">\n                    <input class="opt"\n                        type="radio"\n                        name="size<$=goods_id$>"\n                        value="<$=index$>"\n                        data-id="<$=goods_id$>"\n                        data-stock="<$=item.stock$>"\n                        data-index="<$=index$>"\n                        >\n                    <span class="opt-real <$ if(item.attr_value && item.attr_value.length>2 || item.attr_std_value) { $>opt-long-txt<$ } $>  <$ if (item.stock <= 0) { $>size-sold-out sold-out<$ }  $>">\n                        <$ if (item.attr_std_value){ $>\n                            <$ if(GB_cssRight){ $>\n                                <$=item.attr_value$> / <strong><$=item.attr_std_value$></strong>\n                            <$ }else{ $>\n                                <strong><$=item.attr_std_value$></strong> / <$=item.attr_value$>\n                            <$ } $>\n                        <$ }else{ $>\n                            <$=item.attr_value$>\n                        <$ } $>\n                    </span>\n                </label>\n            <$ }) $>\n        </div>\n    <$ } $>\n<$ } $>\n'}}]);
//# sourceMappingURL=quick-add-module.61ef35.js.map