(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{RneQ:function(t,e,n){"use strict";n.r(e);n("ma9I"),n("TeQF"),n("QWBl"),n("yXV3"),n("oVuX"),n("E9XD"),n("Rfxz"),n("pDQq"),n("qePV"),n("tkto"),n("07d7"),n("5s+n"),n("rB9j"),n("UxlC"),n("EnZy"),n("FZtP"),n("ls82");var i=n("bTtU"),o=n("IIIG");function r(t,e,n,i,o,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(i,o)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function c(t){r(a,i,o,c,s,"next",t)}function s(t){r(a,i,o,c,s,"throw",t)}c(void 0)}))}}var c=gbCommonInfo,s=c.lang,u=c.host,d=c.language,f=c.SiteUID,h=c.IS_RW,l=c.currency;window.cart_module={cartFn:[],cartPromise:null,cartTimer:null,cartCheck:function(t){var e=this;null==this.cartPromise&&(this.cartPromise=$.get("/cart/checkcart",(function(n){for(var i in 0==n.code&&(e.cartVue.res=n,n.info&&n.info.carts&&n.info.carts.length&&e.cartVue.checkStock()),cart_module.cartFn)cart_module.cartFn[i](n);t&&t(n.info)}),"json"))},initialize:function(){this.eventCenter=new Vue,this.initVue(),this.cartCheck()},initVue:function(){var t=this;this.cartVue=new Vue({el:".j-fast-cart",data:{WEB_CLIENT:WEB_CLIENT,res:{},carts:[],info:{},show:!1,loading:!1,summary:{},buy_gifts_num:0,buy_gifts_choose:0,buy_gifts_tip:"",soldOut:[],isLogin:!!SHEIN_W.getCookie("userinfo_email"),gift_empty:!0,buyGift:!1,tips:{show:!1,text:""},limitBuy:0,loginJump:u+"/user/auth/login?redirection="+encodeURIComponent(location.pathname),rangeList:{},cartCouponsInfo:null,showCartCoupon:!1,showQuickCheckout:!1,countDownComputedTimer:null},watch:{res:function(t,e){var n=this,i=this.res;this.getFreeShippingTip(i.info.info?i.info.info.totalPrice.amount:i.info.totalPrice.amount).then((function(t){var e=t&&t.info;if(e){var i=e.filter((function(t){return 1==t.is_show}))[0];n.summary.title=i&&i.tip.replace("[money]",i.price.amountWithSymbol)||"",n.summary.show=!(!i||!i.tip)}else n.summary.title="",n.summary.show=!1})),Vue.set(this,"carts",i.info.carts||i.info.info.carts),Vue.set(this,"summary",{title:"",show:"",originPrice:i.info.originPrice||i.info.info.originPrice,totalPrice:i.info.totalPrice||i.info.info.totalPrice,cartNum:i.info.totalPrice?i.info.cartSumQuantity:i.info.info.cartSumQuantity}),this.buy_gifts_num=0,this.buy_gifts_choose=0,$.each(this.carts,(function(t,e){$.each(e.product.promotionInfo,(function(t,i){2==i.typeId&&(n.buy_gifts_num+=parseInt(e.quantity),1==i.isPresent&&(n.buy_gifts_choose=1))}))})),this.buy_gifts_tip="ar"==s?SHEIN_W.template(this.buy_gifts_num,d.cart_buy_tip_2):SHEIN_W.template(this.buy_gifts_num,d.cart_buy_tip_1);var o=!1;i.info.promotionNew?o=i.info.promotionNew:i.info.info&&i.info.info.promotionNew&&(o=i.info.info.promotionNew),o&&o.fullGifts&&$.each(o.fullGifts,(function(t,e){e.promotionGoods.length&&(n.gift_empty=!1)})),this.buyGift=o&&o.buyGifts&&o.buyGifts.length&&1!=this.buy_gifts_choose,this.info=i.info,h&&this.getCartCouponData(i.info),this.initCart()}},methods:{htmlDecode:SHEIN_W.htmlDecode,getFreeShippingTip:function(t,e){return new Promise((function(n,i){$.get("/cart/getFreeShipping",{amount:t,country_id:e},(function(t){0==t.code&&t.info&&n(t.info)}))}))},shipTitle:function(t){var e=parseInt(t.usd.amount),n=t.price.amountWithSymbol,i="",o=!0;return"stand_shipping"==t.id?e>20?o=!1:i=SHEIN_W.template(n,d.cart_ship_stand):"express_shipping"==t.id?e>30?(i=d.cart_ship_stand_over,"us"==s&&(i=SHEIN_W.template(n,d.cart_ship_express)),1==t.info.length&&(o=!1)):e>0&&e<=30&&(i=SHEIN_W.template(n,d.cart_ship_express)):i=1==t.info.length&&"stand_shipping"==t.info[0].id?d.cart_ship_stand_over:d.cart_ship_express_over,{show:o,title:i=SHEIN_W.htmlDecode(i)}},initCart:function(){var t=0;$.each(this.carts,(function(e,n){!n.relatedProductIds&&0==n.product.stock&&+n.realTimeInventory<+n.quantity||!n.relatedProductIds&&0==n.product.is_on_sale||!n.relatedProductIds&&n.attrs;t+=parseInt(n.quantity)})),this.summary.cartNum=t},handleQuantity:function(e,n,i){var o=this;if(!n&&e.quantity<=1)return e.quantity=1,!1;if(this.loading)return!1;var r=parseInt(e.quantity);if(i)e.quantity=Math.abs(parseInt($(i.target).val()));else{if(e.quantity>=99&&n)return!1;n?e.quantity++:e.quantity--}if(e.quantity>e.realTimeInventory&&e.realTimeInventory>0&&(e.realTimeInventory>99?e.quantity=99:e.quantity=e.realTimeInventory),!e.quantity)return this.showTip(SHEIN_W.htmlDecode(d.lang_cart_enter_amount)),e.quantity=r,!1;if(e.quantity==r)return e.quantity=r,!1;if(e.quantity>999)return this.showTip(d.lang_cart_maxium_num+"999"),e.quantity=r,!1;this.loading=!0;var a=gbExposeTraceid("getProduct",{goods_id:e.product&&e.product.goods_id||""}),c={id:e.id,quantity:e.quantity};a?c.trace_id=a:e.trace_id&&(c.trace_id=e.trace_id),$.post("/cart/update",c,(function(n){o.loading=!1,0==n.code?n.info?Vue.set(o,"res",n.info):Vue.set(o,"res",n):300402==n.code?(e.quantity=r,o.showTip(d.lang_member_out_of_stock)):["200401","500301"].indexOf(n.code)>=0?(e.quantity=r,o.showTip(d.lang_goods_only_one)):500302==n.code?(e.quantity=r,o.showTip(o.template(n.info.limitCount,d.goods_limit_buy))):500303==n.code?(e.quantity=r,o.showTip(d.SHEIN_PC_KEY_3274)):300405==n.code?(e.quantity=r,o.showTip(o.template(e.product.limit_count,d.goods_limit_buy))):(e.quantity=r,o.showTip(d.category_error)),t.analysis.handleQuantity(e,r)}),"json")},showTip:function(t){this.tips.show=!0,this.tips.text=t},del:function(t){var e=this;if(this.loading)return!1;this.loading=!0,$.post("/cart/delete",{id:t.id},(function(t){e.loading=!1,0==t.code&&Vue.set(e,"res",t)}),"json")},isPromotionVal:function(t,e){return t.product.promotionInfo&&t.product.promotionInfo.length&&t.product.promotionInfo.some((function(t){return t.typeId==e}))},getPromotionVal:function(t,e){var n=t.product.promotionInfo&&t.product.promotionInfo.length&&t.product.promotionInfo.filter((function(t){return t.typeId==e}))||[];return n.length?n[0]:{}},checkStock:function(){var t=this;$.get("/cart/checkStock",(function(e){if(0==e.code){var n=[];$.each(e.info.outStockCarts,(function(t,e){n.push(e.id)})),Vue.set(t,"soldOut",n)}}),"json").fail((function(t){}))},hover:function(t){var e=this;return a(regeneratorRuntime.mark((function n(){var i,r,a,c,s,u,d,f,h,l;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t&&window.cart_module.cartTimer&&(clearTimeout(window.cart_module.cartTimer),window.cart_module.cartTimer=null),e.$refs.addBuys&&e.$refs.addBuys.is_show||(e.show=t),!t){n.next=12;break}return n.next=5,o.a.getUserAbtResult({posKeys:"FastCartCK"});case 5:i=n.sent,r=i.FastCartCK,c=(a=void 0===r?{}:r).poskey,s=void 0===c?"":c,u=a.expid,d=void 0===u?"":u,f=a.id,h=void 0===f?"":f,l=a.param,sa("send",{activity_name:"expose_addbagpop",activity_param:{abtest:"".concat(s||"-","`").concat(d||"-","`").concat(h||"-")}}),ga(GB_ANALYSIS_GA_SET,"dimension33","".concat(s,"_").concat(l)),ga(GB_ANALYSIS_GA+".send",{hitType:"event",eventCategory:"快捷购物车",eventAction:"Popup-AddedBag"});case 12:case"end":return n.stop()}}),n)})))()},updateCom:function(t){t&&t.rangeList&&(this.rangeList=t.rangeList)},promotionCutPriceShow:function(t){if(t&&t.reduce_price)return Object.keys(t.reduce_price).length>0&&t.reduce_price.siteFrom==f&&t.reduce_price.reduceAmount.amount>0},getCartCouponData:function(t){var e=this,n=t.totalPrice.amount;$.get("/cart/getCartCoupons?price="+n+"&&currency="+l,(function(t){e.cartCouponsInfo=t.info}))},goCheckout:function(){var e=this;$.get("/cart/checkStock",(function(n){0==n.code&&(n.info.outStockCarts.length?(eventCenter.$emit("sold-out",n),t.analysis.checkout({val:0,msg:"out of stock",carts:e.carts})):SHEIN_W.userModule.check_login_promise("isCheckout").then((function(n){n.username?(t.analysis.checkout({val:1,carts:e.carts}),window.location.href=gbCommonInfo.host+"/checkout"):(t.analysis.checkout({val:0,msg:"Not login",carts:e.carts}),window.location.href=u+"/user/auth/login?cause="+encodeURIComponent("quickCheckout")+"&redirection="+encodeURIComponent(location.pathname))})))}),"json")},percentNum:percentNum,transformImg:transformImg,getGoodsUrl:SHEIN_W.getGoodsUrl,template:SHEIN_W.template},mounted:function(){var t=this;return a(regeneratorRuntime.mark((function e(){var n,i,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.getUserAbtResult({posKeys:"FastCartCK"});case 2:n=e.sent,i=n.FastCartCK,r=(void 0===i?{}:i).param,a=void 0===r?"":r,t.showQuickCheckout="GoToCheckout"==a;case 7:case"end":return e.stop()}}),e)})))()},components:{"icon-vue":i.a}})},recart:function(t){0==t.code&&(this.reCheckStock(t)||Vue.set(this.cartVue,"res",t),this.cartVue.hover(!0),this.autoHideFastCart())},reCheckStock:function(t){var e=this,n=!1;return $.each(t.info.carts,(function(t,i){1*i.quantity>1&&1*i.quantity>i.realTimeInventory&&(e.cartVue.handleQuantity(i),i.quantity=i.realTimeInventory,n=!0)})),n},reload:function(t,e){var n=this;$.get("/cart/checkcart",(function(i){0==i.code&&(Vue.set(n.cartVue,"res",i),Vue.set(n.cartVue,"isLogin",!!SHEIN_W.getCookie("userinfo_email")),1==t&&(n.cartVue.hover(!0),n.autoHideFastCart())),e&&e(i)}),"json")},recordView:function(t){var e=getCookie("view_history")?getCookie("view_history").split(","):[];if(e.indexOf(t)>-1){var n=e.indexOf(t);e.splice(n,1)}e.unshift(t),e.length>24&&(e.length=24),SHEIN_W.setCookie("view_history",e.join(","),2592e3)},analysis:{ecAction:function(t,e){var n=t.product.goods_sn,i={id:t.product.productRelationID||n,name:n,quantity:t.quantity,category:t.product.cat_id,price:GB_ga_transformPrice(t.product.salePrice.amount)};ga(GB_ANALYSIS_GA+".ec:addProduct",i),ga(GB_ANALYSIS_GA+".ec:setAction",e),GBGaSend({category:"快捷购物车",action:"add"==e?"QtyAdd":"QtyLess",label:n})},handleQuantity:function(t,e){e=Number(e);var n,i={};$.extend(!0,i,t),i.quantity>e?n="add":i.quantity<e&&(n="remove"),i.quantity=Math.abs(i.quantity-e),this.ecAction(i,n)},checkout:function(t){return a(regeneratorRuntime.mark((function e(){var n,i,r,a,c,s,u,d,f,h,l,p,m,_,g,y,v,w,I;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.val,i=void 0===n?1:n,r=t.carts,a=void 0===r?[]:r,c=t.msg,s=void 0===c?"":c,e.next=3,o.a.getUserAbtResult({posKeys:"FastCartCK"});case 3:u=e.sent,d=u.FastCartCK,h=(f=void 0===d?{}:d).poskey,l=void 0===h?"":h,p=f.expid,m=void 0===p?"":p,_=f.id,g=void 0===_?"":_,y=f.param,"function"==typeof ga&&(a.forEach((function(t){var e={id:t.product.productRelationID||t.product.goods_sn,category:t.product.cat_id,quantity:t.quantity,name:t.product.goods_sn,price:GB_ga_transformPrice(t.unitPrice.amount),variant:t.attr.attr_value};ga(GB_ANALYSIS_GA+".ec:addProduct",e)})),ga(GB_ANALYSIS_GA+".ec:setAction","checkout",{step:1}),ga(GB_ANALYSIS_GA_SET,"dimension33","".concat(l,"_").concat(y)),ga(GB_ANALYSIS_GA+".send",{hitType:"event",eventCategory:"快捷购物车",eventAction:"Checkout",eventValue:i,transport:"beacon"})),"function"==typeof sa&&("",{},I="","sold out"==s?I=2:"Not login"==s&&(I=1),v=a.reduce((function(t,e){var n=e.attr.goods_id||"",i=e.attr.attr_value_id||"",o=e.quantity||"";return t.push("".concat(n,"`").concat(i,"`").concat(o)),t}),[]).join(","),w={goods_list:v,result:i?1:2,result_reason:I,abtest:"".concat(l||"-","`").concat(m||"","`").concat(g||"-")},sa("send",{activity_name:"click_checkout",activity_param:w}));case 9:case"end":return e.stop()}}),e)})))()}},autoHideFastCart:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3e3,e=this;e.cartTimer=setTimeout((function(){e.cartVue.hover(!1)}),t)}},$((function(){cart_module.initialize()}))},bTtU:function(t,e,n){"use strict";var i={props:{item:{type:Object,default:{}}},name:"icon-vue"},o=n("KHd+"),r=Object(o.a)(i,(function(){var t=this.$createElement,e=this._self._c||t;return e("em",{staticClass:"tip-red"},[e("i",{directives:[{name:"show",rawName:"v-show",value:this.item.currentIds[3],expression:"item.currentIds['3']"}],staticClass:"iconfont icon-limitedoff-new"}),this._v(" "),e("i",{directives:[{name:"show",rawName:"v-show",value:this.item.currentIds[8],expression:"item.currentIds['8']"}],staticClass:"iconfont icon-apponly-new"}),this._v(" "),e("i",{directives:[{name:"show",rawName:"v-show",value:this.item.currentIds[10],expression:"item.currentIds['10']"}],staticClass:"flash-sale-icon iconfont icon-flashsale_icon"})])}),[],!1,null,null,null);e.a=r.exports}}]);
//# sourceMappingURL=cart-module.85d296.js.map