(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{rd0b:function(o,e,t){"use strict";t.r(e);t("ma9I"),t("TeQF"),t("yq1k"),t("2B1R"),t("qePV"),t("07d7"),t("rB9j"),t("JfAA"),t("JTJg"),t("UxlC"),t("EnZy"),t("QWBl"),t("oVuX"),t("E9XD"),t("FZtP");function n(o){var e=o.coupons,t=o.type,n=void 0===t?"ga":t,i=o.isTheme;if(!e||!e.length)return"";var c=[];return e.forEach((function(o,e,t){"ga"==n?(0==e||e>0&&o.crowd!=t[e-1].crowd)&&c.push(o.crowd||"通用券包"):"bi"==n&&o&&c.push(e+1+"`"+(o.crowd||"通用券"))})),c=c.join("ga"==n?"-":","),"ga"==n&&(c+=i?"&自定义样式":"&默认样式"),c}function i(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,t=e.jumpType,i=void 0===t?0:t,c=e.coupons,s=void 0===c?[]:c,a=e.act_id,u=void 0===a?"":a;if(!o)return{};if(!SaPageInfo)return{};var p=SaPageInfo.page_id||"",l=o.scene_id,r=void 0===l?0:l,_=o.scene_name,d=void 0===_?0:_,g=o.oper_id,h=void 0===g?0:g,v=o.style_id,m=void 0===v?1:v,C=o.id,f=SHEIN_W.getCookie("pwa_user_email")?"50000":"50001",k="".concat(p,"`0`").concat(r,"_").concat(d,"`0`0`").concat(h,"`1`").concat(m,"`").concat(f,"`0`0`0`").concat(i,"`").concat(C),w=s.reduce((function(o,e,t,n){return o+(e.couponId+(t==n.length-1?"":"`"))}),""),S={spm:k,act_id:u,content_list:w,abtest:"-`-`-",coupon_crowd_id:n({coupons:s,type:"bi"})};return S}var c={expose_pop_coupon:function(o){o.login_type;var e=o.coupons,t=o._config_;try{var n=i(t,{coupons:e});sa("send",{activity_name:"expose_popup",activity_param:n})}catch(o){console.log(o)}},click_pop_coupon_close:function(o){var e=o.coupons,t=o._config_;try{var n=i(t,{coupons:e,act_id:0});sa("send",{activity_name:"click_popup",activity_param:n})}catch(o){console.log(o)}},click_pop_coupon_receive:function(o){var e=o.coupons,t=o._config_;try{var n=i(t,{coupons:e,act_id:1});sa("send",{activity_name:"click_popup",activity_param:n})}catch(o){console.log(o)}},click_pop_coupon_ok:function(o){var e=o.coupons,t=o._config_;try{var n=i(t,{coupons:e,act_id:1});sa("send",{activity_name:"click_popup",activity_param:n})}catch(o){console.log(o)}},click_auto_coupon_get:function(o){var e=o.status,t=void 0===e?"success":e,i=o.login_type,c=void 0===i?"logged":i,s=o.coupons;o._config_;try{sa("send",{activity_name:"click_auto_coupon_get",activity_param:{status:t,login_type:c,coupon_crowd_id:n({coupons:s,type:"bi"})}})}catch(o){console.log(o)}},click_login_back_get:function(o){var e=o.coupons,t=i(o._config_,{coupons:e,act_id:1});sa("send",{activity_name:"click_popup",activity_param:t})}},s={PopUpsCoupons:function(o){var e=o.login,t=n({coupons:o.coupons,isTheme:o.isTheme}),i="PopUps-";i+=e?"SignedInCoupons":"NotSignedInCoupons",ga(GB_ANALYSIS_GA_SEND,{hitType:"event",eventCategory:"MyCoupons",eventAction:i,eventLabel:t})},autoCollect:function(o){var e=o.value,t=void 0===e?0:e,i=n({coupons:o.coupons,isTheme:o.isTheme});ga(GB_ANALYSIS_GA_SEND,{hitType:"event",eventCategory:"MyCoupons",eventAction:"CollectAllSuccess-SignedInCoupons",eventLabel:i,eventValue:t})},clickOk:function(o){o.value;var e=n({coupons:o.coupons,isTheme:o.isTheme});ga(GB_ANALYSIS_GA_SEND,{hitType:"event",eventCategory:"MyCoupons",eventAction:"ClickOk-SignedInCoupons",eventLabel:e})},clickRecieve:function(o){var e=n({coupons:o.coupons,isTheme:o.isTheme});ga(GB_ANALYSIS_GA_SEND,{hitType:"event",eventCategory:"MyCoupons",eventAction:"ClickCollectAll-NotSignedInCoupons",eventLabel:e})},loginBackGet:function(o){var e=o.value,t=void 0===e?1:e,i=n({coupons:o.coupons,isTheme:o.isTheme});ga(GB_ANALYSIS_GA_SEND,{hitType:"event",eventCategory:"MyCoupons",eventAction:"CollectAllSuccess-NotSignedInCoupons",eventLabel:i,eventValue:t})},clickClose:function(o){var e=o.coupons,t=o.isTheme,i=o.login,c=n({coupons:e,isTheme:t});ga(GB_ANALYSIS_GA_SEND,{hitType:"event",eventCategory:"MyCoupons",eventAction:i?"ClosePopUps-SignedInCoupons":"ClosePopUps-NotSignedInCoupons",eventLabel:c})}},a=gbCommonInfo,u=a.language,p=a.GB_cssRight,l={props:{showCouponCode:{type:[Boolean],default:!1},item:{type:[Object],required:!0},theme:{type:[Object],required:!1,default:function(){return{}}}},data:function(){return{GB_cssRight:p,language:u}},computed:{couponTypeText:function(){var o="",e=this.item,t=this.language;return"5"===e.applyFor||"6"===e.applyFor?o=t.SHEIN_PC_KEY_3166:"1"===e.ruleDimension?o="-".concat(e.rule[0].value.amountWithSymbol):"2"!==e.ruleDimension&&"5"!==e.ruleDimension||(o=t.SHEIN_PC_KEY_3255.replace("{0}",+e.rule[0].value.amount+"%")),o}},filters:{formatTime:function(o){o=o.replace(/-/gi,"/");var e=new Date(o+" GMT+0800"),t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),c=e.getHours(),s=e.getMinutes(),a=e.getSeconds();return n<10&&(n="0"+n),i<10&&(i="0"+i),c<10&&(c="0"+c),s<10&&(s="0"+s),a<10&&(a="0"+a),i+"/"+n+"/"+t+" "+c+":"+s}}},r=t("KHd+"),_=Object(r.a)(l,(function(){var o=this,e=o.$createElement,t=o._self._c||e;return o.item&&o.item.couponId?t("li",{class:["c-coupon-item-vue","size-s",o.GB_cssRight?"coupon-css-right":"",o.theme.couponBorderColor&&3==o.theme.couponBorderColor?"white":""]},[t("div",{staticClass:"coupon-text coupon-type"},[o._v(o._s(o.couponTypeText))]),o._v(" "),t("div",{staticClass:"coupon-text discount-threshold"},[o._v(o._s(o.language.SHEIN_PC_KEY_3253.replace("{0}",o.item.rule[0].min.amountWithSymbol)))]),o._v(" "),"1"===o.item.applyFor?t("div",{staticClass:"coupon-text"},[o._v(o._s(o.language.SHEIN_PC_KEY_3215))]):["2","3","4","7"].includes(o.item.applyFor)?t("div",{staticClass:"coupon-text"},[o._v(o._s(o.language.SHEIN_PC_KEY_3225))]):o._e(),o._v(" "),t("div",{staticClass:"coupon-text"},[o._v(o._s(o._f("formatTime")(o.item.startTime))+" ~ "+o._s(o._f("formatTime")(o.item.endTime)))]),o._v(" "),o.showCouponCode?t("div",{staticClass:"coupon-code"},[o._v(o._s(o.item.couponCode))]):o._e()]):o._e()}),[],!1,null,null,null).exports,d=gbCommonInfo,g=d.language,h=d.langPath,v=d.lang;var m={name:"vue-coupon-package",components:{couponItem:_},data:function(){return{lang:v,langPath:h,language:g,show:{coupon:!1,mask:!1,message:!1,btnShadow:!1,login:!1},messageTip:"",data:[],couponId:"",login:!1,isLoginBack:!1,bindSuccess:!1,theme:{}}},computed:{crowdCoupons:function(){return this.data.filter((function(o){return o.crowd}))},couponTitle:function(){var o=this.login?this.language.SHEIN_PC_KEY_4199:this.language.SHEIN_PC_KEY_4200;return this.bindSuccess?this.theme&&this.theme.textAfter&&(o=this.theme.textAfter):this.theme&&this.theme.textAfter&&(o=this.theme.textBefore),o}},mounted:function(){this.login=!!SHEIN_W.getCookie("userinfo_email"),SHEIN_W.getCookie("getCoupon")&&(this.isLoginBack=!0),this.getCoupon()},filters:{formatTime:function(o){o=o.replace(/-/gi,"/");var e=new Date(o+" GMT+0800"),t=e.getFullYear(),n=e.getMonth()+1,i=e.getDate(),c=e.getHours(),s=e.getMinutes(),a=e.getSeconds();return n<10&&(n="0"+n),i<10&&(i="0"+i),c<10&&(c="0"+c),s<10&&(s="0"+s),a<10&&(a="0"+a),i+"/"+n+"/"+t+" "+c+":"+s}},methods:{template:SHEIN_W.template,transformImg:transformImg,bindCoupon:function(o){var e=this;$.ajax({type:"POST",url:"/product/bindCouponPackage",data:{couponId:e.couponId},success:function(o){if("0"===o.code&&o.info.bindResult&&o.info.bindResult.successList&&o.info.bindResult.successList.length>0){e.bindSuccess=!0;var t=o.info.bindResult.successList.map((function(o){return o.couponId.toString()}));e.data=e.data.filter((function(o){return t.includes(o.couponId.toString())})),e.showCoupon(),e.analysis_operator("autoCouponGet",{value:1}),e.isLoginBack&&SHEIN_W.delCookie("getCoupon")}else e.bindSuccess=!1,e.closeCoupon(),e.isLoginBack?(SHEIN_W.delCookie("getCoupon"),e.analysis_operator("loginBackGet",{value:0})):e.analysis_operator("autoCouponGet",{value:0})}})},getCoupon:function(){var o=this;$.ajax({type:"GET",url:"/product/getCouponPackage",success:function(e){if(e.theme&&o.setTheme(e.theme),"0"==e.code&&e.info&&e.info.couponPackage&&e.info.couponPackage.coupon&&e.info.couponPackage.coupon.length>0)return o.couponId=e.info.couponPackage.id,o.data=e.info.couponPackage.coupon,void(o.login?o.judgeShowCoupon("bind"):o.judgeShowCoupon("show"));o.closeCoupon(),"501402"==e.code&&o.isLoginBack&&(o.showMessage(g.SHEIN_PC_KEY_3292),SHEIN_W.delCookie("getCoupon"),o.analysis_operator("loginBackGet",{value:1})),SHEIN_W.setCookie("hideCoupon","1",600),window._GB_PopUpModalEventCenter_.done("coupon")},error:function(){o.closeCoupon(),window._GB_PopUpModalEventCenter_.done("coupon")}})},judgeShowCoupon:function(o){var e=SHEIN_W.getCookie("hideCouponWithRequest"),t=SHEIN_W.getCookie("hideCouponId_time");e&&t?t.split("_")[0]==this.couponId?this.closeCoupon():(SHEIN_W.delCookie("hideCouponId_time"),SHEIN_W.delCookie("hideCouponWithRequest"),SHEIN_W.delCookie("hideCoupon"),"bind"==o?this.bindCoupon():this.showCoupon()):"bind"==o?this.bindCoupon():this.showCoupon()},showCoupon:function(o){var e=this;window._GB_PopUpModalEventCenter_.pushQueue("coupon",(function(){e.show.coupon=!0,e.show.mask=!0,e.computedBtnShadow(),e.analysis_operator("exposePop")}))},closeCoupon:function(o){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";if(this.show.coupon=!1,this.show.mask=!1,!o&&(SHEIN_W.setCookie("hideCoupon","1",86400),"clickBtn"==e)){var t=SHEIN_W.getCookie("hideCouponId_time");if(t){var n=Number(t.split("_")[1])||0;1==n?(SHEIN_W.setCookie("hideCouponWithRequest","1",604800),SHEIN_W.setCookie("hideCouponId_time","".concat(this.couponId,"_").concat(n+1))):n>=2&&(SHEIN_W.setCookie("hideCouponWithRequest","1",31536e4),SHEIN_W.setCookie("hideCouponId_time","".concat(this.couponId,"_").concat(n+1)))}else SHEIN_W.setCookie("hideCouponWithRequest","1",86400),SHEIN_W.setCookie("hideCouponId_time","".concat(this.couponId,"_1"))}"clickBtn"==e?this.analysis_operator("closePop"):"ok"==e&&this.analysis_operator("popCouponOk"),window._GB_PopUpModalEventCenter_.next("coupon")},showMessage:function(o){this.messageTip=o,this.show.message=!0},closeMessage:function(){this.show.message=!1,this.messageTip=""},computedBtnShadow:function(){var o=this;setTimeout((function(){(document.querySelector(".coupon-list")?document.querySelector(".coupon-list").offsetHeight:0)>(document.querySelector(".coupon-content")?document.querySelector(".coupon-content").offsetHeight:0)&&(o.show.btnShadow=!0)}),0)},goLogin:function(){this.show.login=!0,window.LOGIN_GA_POPUPS_SEND({scenes:"coupons"}),this.analysis_operator("popCouponReceive")},loginSuc:function(){this.login=!0,this.isLoginBack=!0,window.welcomePrivacyVue&&window.welcomePrivacyVue.welcomehide(),window.quickRegister&&window.quickRegister.absoluteHide(),SHEIN_W.userModule.update_top_login(),window.cart_module&&window.cart_module.reload(),this.getCoupon(),this.loginClose(!0)},loginClose:function(){var o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.show.login=!1,!0!==o&&window.LOGIN_GA_CLOSE_POPUPS_SEND({scenes:"coupons"})},setTheme:function(o){if(o){o.content&&o.content[0]&&o.content[0].content&&o.content[0].content.props&&o.content[0].content.props.items&&o.content[0].content.props.items[0]&&(this.theme=o.content[0].content.props.items[0],this.theme.style=o.content[0].content.props.style,this.theme.custom="COUPON_BAG_POP1"!=o.content[0].content.props.style.type);var e={};e.scene_id=o.scene_id,e.scene_name=o.scene_name,e.oper_id=o.content&&o.content[0]?o.content[0].oper_id:0,e.oper_name=o.content&&o.content[0]?o.content[0].oper_name:"",e.style_id=o.content&&o.content[0]&&o.content[0].content&&o.content[0].content.props&&o.content[0].content.props.style&&"COUPON_BAG_POP1"==o.content[0].content.props.style.type?"1":"2",this.theme._config_=e}},analysis_operator:function(){var o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,t=this,n=t.theme.custom,i=this.theme._config_,a=void 0===i?{}:i;switch(o){case"closePop":c&&c.click_pop_coupon_close({coupons:t.data,_config_:a}),s&&s.clickClose({coupons:t.data,isTheme:n,login:t.login});break;case"exposePop":c&&c.expose_pop_coupon({login_type:t.login?"logged":"logout",coupons:t.data,_config_:a}),s&&s.PopUpsCoupons({login:t.login,coupons:t.data,isTheme:n});break;case"popCouponOk":c&&c.click_pop_coupon_ok({coupons:t.data,_config_:a}),s&&s.clickOk({coupons:t.data,isTheme:n});break;case"popCouponReceive":c&&c.click_pop_coupon_receive({coupons:t.data,_config_:a}),s&&s.clickRecieve({coupons:t.data,isTheme:n});break;case"autoCouponGet":var u=e.value;c&&c.click_auto_coupon_get({status:u?"success":"failure",login_type:t.login?"logged":"logout",coupons:t.data}),s&&s.autoCollect({value:u,coupons:t.data,isTheme:n});break;case"loginBackGet":var p=e.value;c&&c.click_login_back_get({coupons:t.data,_config_:a}),s&&s.loginBackGet({value:p,coupons:t.data,isTheme:n})}}}},C=Object(r.a)(m,(function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("transition",{attrs:{name:"vue-fade",appear:""}},[t("div",{staticClass:"c-vue-coupon",on:{click:function(o){o.stopPropagation()}}},[t("div",{directives:[{name:"show",rawName:"v-show",value:o.show.mask,expression:"show.mask"}],staticClass:"coupon-mask she-scroll-hide",class:{"she-opacity0":!o.show.mask}},[t("transition",{attrs:{name:"vue-slide-fade"},on:{click:function(o){o.stopPropagation()}}},[t("div",{staticClass:"coupon-background"},[o.show.coupon?t("div",{staticClass:"c-coupon-box",style:[o.theme.imgSrc?{background:"url("+o.transformImg(o.theme.imgSrc)+") no-repeat",backgroundSize:"cover"}:{}]},[t("i",{staticClass:"iconfont icon-close she-close",style:[o.theme.textColor?{color:o.theme.textColor}:{}],on:{click:function(e){e.stopPropagation(),o.closeCoupon(!1,"clickBtn")}}}),o._v(" "),t("div",{staticClass:"coupon-title"},[t("p",{staticClass:"tip-common",style:[o.theme.textColor?{color:o.theme.textColor}:{}]},[o._v(o._s(o.couponTitle))])]),o._v(" "),t("div",{staticClass:"coupon-content",on:{click:function(o){o.stopPropagation()}}},[t("ul",{staticClass:"coupon-list"},o._l(o.data,(function(e){return t("coupon-item",{key:e.couponId,attrs:{item:e,theme:o.theme,showCouponCode:o.login}})})))]),o._v(" "),t("div",{staticClass:"coupon-btn",class:{"show-shadow":o.show.btnShadow},on:{click:function(o){o.stopPropagation()}}},[o.login?t("div",{staticClass:"she-btn-black",on:{click:function(e){o.closeCoupon(!1,"ok")}}},[o._v(o._s(o.language.lang_member_ok))]):t("div",{staticClass:"she-btn-black",on:{click:o.goLogin}},[o._v(o._s(o.language.SHEIN_PC_KEY_3156))])])]):o._e()])])],1),o._v(" "),t("div",{staticClass:"j-coupon-message"},[t("modal-vue",{attrs:{show:o.show.message,twobtn:!1},on:{ok:o.closeMessage,cancel:o.closeMessage}},[t("div",{staticStyle:{"text-align":"center","line-height":"1.7"}},[o._v(o._s(o.messageTip))])])],1),o._v(" "),t("div",{staticClass:"c-login-vue-dialog"},[t("modal-vue",{staticClass:"c-login",attrs:{show:o.show.login,"relative-width-m":!0,force:!0},on:{cancel:o.loginClose}},[t("div",{attrs:{slot:"title"},slot:"title"}),o._v(" "),t("login-vue",{ref:"mainLogin",on:{"login-suc-callback":o.loginSuc}}),o._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)])])}),[],!1,null,null,null).exports;$(".j-vue-coupon-package-container").length>0?window.couponPackage=new Vue({components:{"vue-coupon-package":C},template:"<vue-coupon-package></vue-coupon-package>",el:".j-vue-coupon-package-container",data:{},methods:{}}):window._GB_PopUpModalEventCenter_.done("coupon")}}]);
//# sourceMappingURL=coupon-module.b05573.js.map